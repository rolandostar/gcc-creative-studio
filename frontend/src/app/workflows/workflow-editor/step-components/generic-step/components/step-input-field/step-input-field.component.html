<label>{{ config.label }}</label>

<div [class.controls-row]="mode !== 'mixed'" [class.mb-4]="mode === 'mixed'">

  <!-- Media Input (Fixed or Mixed) -->
  <ng-container *ngIf="mode === 'mixed' || (mode === 'fixed' && (config.type === 'image' || config.type === 'video'))">
    <app-step-media-input
      [control]="control"
      [inputName]="config.name"
      [type]="$any(config.type)"
      [maxItems]="maxMediaItems"
      [compatibleOutputs]="compatibleOutputs"
      [showValidationErrors]="showValidationErrors">
    </app-step-media-input>
  </ng-container>

  <!-- Mode Selector -->
  <!-- Only show switch if not in mixed mode AND not an image/video input (since media input handles both) -->
  <mat-form-field
    *ngIf="mode !== 'mixed' && config.type !== 'image' && config.type !== 'video'"
    appearance="outline"
    class="mode-select"
  >
    <mat-select [value]="mode" (selectionChange)="toggleInputMode($event.value)">
      <mat-option value="fixed">Fixed</mat-option>
      <mat-option value="linked">Link</mat-option>
    </mat-select>
  </mat-form-field>

  <!-- Textarea Input (Fixed) -->
  <mat-form-field *ngIf="mode === 'fixed' && config.type === 'textarea'" appearance="outline" class="value-input">
    <textarea matInput [formControl]="control" [placeholder]="config.label" rows="2"></textarea>
    <mat-error *ngIf="showValidationErrors && control.hasError('required')">
      {{ config.label }} is required
    </mat-error>
  </mat-form-field>

  <!-- Text Input (Fixed) -->
  <mat-form-field *ngIf="mode === 'fixed' && config.type === 'text'" appearance="outline" class="value-input">
    <input matInput [formControl]="control" [placeholder]="config.label">
    <mat-error *ngIf="showValidationErrors && control.hasError('required')">
      {{ config.label }} is required
    </mat-error>
  </mat-form-field>

  <!-- Linked Input (Select) -->
  <!-- Also hide this for image/video as step-media-input handles linked outputs too -->
  <mat-form-field
    *ngIf="mode === 'linked' && config.type !== 'image' && config.type !== 'video'"
    appearance="outline"
    class="value-input"
  >
    <mat-select [formControl]="control" [compareWith]="compareFn">
      <mat-option *ngFor="let out of compatibleOutputs" [value]="out.value">
        {{ out.label }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="showValidationErrors && control.hasError('required')">
      Input is required
    </mat-error>
  </mat-form-field>

</div>
